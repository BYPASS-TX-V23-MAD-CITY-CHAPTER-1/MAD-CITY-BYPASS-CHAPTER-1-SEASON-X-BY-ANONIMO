-- CONFIGURAÇÃO
local keyCorreta = "Duck"
local tempoLimite = 120 * 60 * 60 -- 12 horas em segundos
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer
local id = "TXDATA_" .. LocalPlayer.UserId
local data = {}

-- TRATAMENTO DE ERROS AO CARREGAR DADOS
local function carregarDados()
    local sucesso, dados = pcall(function()
        if isfile(id .. ".json") then
            return HttpService:JSONDecode(readfile(id .. ".json"))
        end
        return {}
    end)
    return sucesso and dados or {}
end

data = carregarDados()

-- INICIALIZAR TEMPO SE NÃO EXISTIR
if not data.inicio then
    data.inicio = os.time()
    pcall(function()
        writefile(id .. ".json", HttpService:JSONEncode(data))
    end)
end

-- VERIFICAR TEMPO RESTANTE
local tempoRestante = tempoLimite - (os.time() - data.inicio)
if tempoRestante <= 0 then
    game.StarterGui:SetCore("SendNotification", {
        Title = "TX Premium",
        Text = "❌ Seu tempo acabou.",
        Duration = 6
    })
    return
end

-- FUNÇÃO PARA CRIAR ELEMENTOS DE UI
local function criarElemento(tipo, props)
    local elemento = Instance.new(tipo)
    for prop, valor in pairs(props) do
        elemento[prop] = valor
    end
    return elemento
end

-- ANIMAÇÃO DE CARREGAMENTO PREMIUM
local function animacaoCarregamento()
    local loadingGui = criarElemento("ScreenGui", {
        Name = "TX_Loading",
        Parent = game.CoreGui,
        IgnoreGuiInset = true
    })

    -- FUNDO GRADIENTE
    local background = criarElemento("Frame", {
        Parent = loadingGui,
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = Color3.fromRGB(5, 5, 10),
        BorderSizePixel = 0
    })

    local gradient = criarElemento("UIGradient", {
        Parent = background,
        Rotation = 90,
        Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.fromRGB(0, 10, 20)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(0, 30, 50))
        })
    })

    -- LOGO MAD CITY
    local logo = criarElemento("TextLabel", {
        Parent = background,
        Size = UDim2.new(0, 0, 0, 0),
        Position = UDim2.new(0.5, 0, 0.4, 0),
        Text = "MAD CITY",
        Font = Enum.Font.GothamBlack,
        TextSize = 36,
        TextColor3 = Color3.fromRGB(0, 200, 255),
        BackgroundTransparency = 1,
        TextStrokeColor3 = Color3.fromRGB(0, 50, 100),
        TextStrokeTransparency = 0.5,
        AnchorPoint = Vector2.new(0.5, 0.5)
    })

    TweenService:Create(logo, TweenInfo.new(0.8, Enum.EasingStyle.Quint), {
        Size = UDim2.new(0, 300, 0, 60),
        TextSize = 48
    }):Play()

    -- TEXTO TX
    local txText = criarElemento("TextLabel", {
        Parent = background,
        Size = UDim2.new(0, 200, 0, 40),
        Position = UDim2.new(0.5, -100, 0.5, 0),
        Text = "TX",
        Font = Enum.Font.GothamBlack,
        TextSize = 32,
        TextColor3 = Color3.fromRGB(255, 255, 255),
        BackgroundTransparency = 1,
        TextTransparency = 1
    })

    task.wait(1)
    TweenService:Create(txText, TweenInfo.new(0.5), {
        TextTransparency = 0
    }):Play()

    -- BARRA DE PROGRESSO
    local barContainer = criarElemento("Frame", {
        Parent = background,
        Size = UDim2.new(0, 300, 0, 6),
        Position = UDim2.new(0.5, -150, 0.6, 0),
        BackgroundColor3 = Color3.fromRGB(30, 30, 50),
        BorderSizePixel = 0,
        AnchorPoint = Vector2.new(0.5, 0)
    })

    local barProgress = criarElemento("Frame", {
        Parent = barContainer,
        Size = UDim2.new(0, 0, 1, 0),
        BackgroundColor3 = Color3.fromRGB(0, 200, 255),
        BorderSizePixel = 0
    })

    local barGlow = criarElemento("Frame", {
        Parent = barProgress,
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = Color3.fromRGB(0, 255, 255),
        BackgroundTransparency = 0.7,
        BorderSizePixel = 0
    })

    -- ANIMAÇÃO DA BARRA
    TweenService:Create(barProgress, TweenInfo.new(2, Enum.EasingStyle.Quint), {
        Size = UDim2.new(1, 0, 1, 0)
    }):Play()

    -- TEXTO ANÔNIMO
    task.wait(1.5)
    txText.Text = "ANÔNIMO"
    txText.TextColor3 = Color3.fromRGB(200, 200, 200)
    txText.TextSize = 28

    -- REMOVER APÓS 3 SEGUNDOS
    task.wait(1.5)
    TweenService:Create(background, TweenInfo.new(0.5), {
        BackgroundTransparency = 1
    }):Play()
    task.wait(0.5)
    loadingGui:Destroy()
end

-- GUI PRINCIPAL
local gui = criarElemento("ScreenGui", {
    Name = "TX_Painel",
    Parent = game.CoreGui,
    ResetOnSpawn = false
})

-- TELA DE LOGIN
local loginFrame = criarElemento("Frame", {
    Parent = gui,
    Size = UDim2.new(0, 350, 0, 220),
    Position = UDim2.new(0.5, -175, 0.5, -110),
    BackgroundColor3 = Color3.fromRGB(10, 15, 20),
    BorderSizePixel = 0,
    ClipsDescendants = true
})

criarElemento("UICorner", {
    Parent = loginFrame,
    CornerRadius = UDim.new(0, 8)
})

-- SOMBRA
local shadow = criarElemento("ImageLabel", {
    Parent = loginFrame,
    Size = UDim2.new(1, 10, 1, 10),
    Position = UDim2.new(0, -5, 0, -5),
    Image = "rbxassetid://1316045217",
    ImageColor3 = Color3.fromRGB(0, 0, 0),
    ImageTransparency = 0.8,
    ScaleType = Enum.ScaleType.Slice,
    SliceCenter = Rect.new(10, 10, 118, 118),
    BackgroundTransparency = 1
})

-- TÍTULO LOGIN
local tituloLogin = criarElemento("TextLabel", {
    Parent = loginFrame,
    Size = UDim2.new(1, 0, 0, 50),
    Text = "TX PREMIUM",
    Font = Enum.Font.GothamBlack,
    TextSize = 24,
    TextColor3 = Color3.fromRGB(0, 200, 255),
    BackgroundTransparency = 1,
    TextStrokeColor3 = Color3.fromRGB(0, 50, 100),
    TextStrokeTransparency = 0.5
})

-- CAMPO DE KEY
local inputKey = criarElemento("TextBox", {
    Parent = loginFrame,
    PlaceholderText = "Digite sua Key...",
    Size = UDim2.new(0.85, 0, 0, 35),
    Position = UDim2.new(0.075, 0, 0, 70),
    TextSize = 14,
    Font = Enum.Font.Gotham,
    Text = "",
    ClearTextOnFocus = false,
    BackgroundColor3 = Color3.fromRGB(20, 25, 35),
    TextColor3 = Color3.new(1, 1, 1)
})

criarElemento("UICorner", {
    Parent = inputKey,
    CornerRadius = UDim.new(0, 6)
})

-- BOTÃO LOGIN
local btnLogin = criarElemento("TextButton", {
    Parent = loginFrame,
    Size = UDim2.new(0.85, 0, 0, 40),
    Position = UDim2.new(0.075, 0, 0, 120),
    Text = "ENTRAR",
    Font = Enum.Font.GothamBlack,
    TextSize = 16,
    TextColor3 = Color3.new(1, 1, 1),
    BackgroundColor3 = Color3.fromRGB(0, 150, 200)
})

criarElemento("UICorner", {
    Parent = btnLogin,
    CornerRadius = UDim.new(0, 6)
})

-- MENU PRINCIPAL (APÓS LOGIN)
local mainFrame = criarElemento("Frame", {
    Parent = gui,
    Size = UDim2.new(0, 400, 0, 450),
    Position = UDim2.new(0.5, -200, 0.5, -225),
    BackgroundColor3 = Color3.fromRGB(10, 15, 20),
    BorderSizePixel = 0,
    Visible = false,
    ClipsDescendants = true
})

criarElemento("UICorner", {
    Parent = mainFrame,
    CornerRadius = UDim.new(0, 8)
})

-- CABEÇALHO
local header = criarElemento("Frame", {
    Parent = mainFrame,
    Size = UDim2.new(1, 0, 0, 50),
    BackgroundColor3 = Color3.fromRGB(15, 20, 30),
    BorderSizePixel = 0
})

criarElemento("UICorner", {
    Parent = header,
    CornerRadius = UDim.new(0, 8)
})

local tituloMain = criarElemento("TextLabel", {
    Parent = header,
    Size = UDim2.new(0.7, 0, 1, 0),
    Position = UDim2.new(0.15, 0, 0, 0),
    Text = "TX PREMIUM v6.0",
    Font = Enum.Font.GothamBlack,
    TextSize = 18,
    TextColor3 = Color3.fromRGB(0, 200, 255),
    BackgroundTransparency = 1
})

-- BOTÃO MINIMIZAR
local btnMinimizar = criarElemento("TextButton", {
    Parent = header,
    Size = UDim2.new(0, 40, 0, 40),
    Position = UDim2.new(1, -45, 0.5, -20),
    Text = "_",
    Font = Enum.Font.GothamBlack,
    TextSize = 24,
    TextColor3 = Color3.new(1, 1, 1),
    BackgroundColor3 = Color3.fromRGB(20, 25, 40)
})

criarElemento("UICorner", {
    Parent = btnMinimizar,
    CornerRadius = UDim.new(0, 6)
})

-- PERFIL DO USUÁRIO
local profileFrame = criarElemento("Frame", {
    Parent = mainFrame,
    Size = UDim2.new(1, -20, 0, 80),
    Position = UDim2.new(0, 10, 0, 60),
    BackgroundColor3 = Color3.fromRGB(15, 20, 30),
    BorderSizePixel = 0
})

criarElemento("UICorner", {
    Parent = profileFrame,
    CornerRadius = UDim.new(0, 8)
})

local avatarFrame = criarElemento("Frame", {
    Parent = profileFrame,
    Size = UDim2.new(0, 50, 0, 50),
    Position = UDim2.new(0, 15, 0.5, -25),
    BackgroundColor3 = Color3.fromRGB(20, 25, 40),
    BorderSizePixel = 0
})

criarElemento("UICorner", {
    Parent = avatarFrame,
    CornerRadius = UDim.new(1, 0)
})

local avatar = criarElemento("ImageLabel", {
    Parent = avatarFrame,
    Size = UDim2.new(1, -4, 1, -4),
    Position = UDim2.new(0, 2, 0, 2),
    BackgroundTransparency = 1,
    Image = Players:GetUserThumbnailAsync(LocalPlayer.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size100x100)
})

criarElemento("UICorner", {
    Parent = avatar,
    CornerRadius = UDim.new(1, 0)
})

local nomeUsuario = criarElemento("TextLabel", {
    Parent = profileFrame,
    Size = UDim2.new(0, 250, 0, 25),
    Position = UDim2.new(0, 80, 0, 15),
    Text = LocalPlayer.Name,
    Font = Enum.Font.GothamBold,
    TextSize = 16,
    TextColor3 = Color3.fromRGB(220, 220, 220),
    BackgroundTransparency = 1,
    TextXAlignment = Enum.TextXAlignment.Left
})

local tempoLabel = criarElemento("TextLabel", {
    Parent = profileFrame,
    Size = UDim2.new(0, 250, 0, 20),
    Position = UDim2.new(0, 80, 0, 45),
    Text = "⏳ " .. math.floor(tempoRestante/3600) .. "h " .. math.floor((tempoRestante%3600)/60) .. "m restantes",
    Font = Enum.Font.Gotham,
    TextSize = 14,
    TextColor3 = Color3.fromRGB(150, 150, 150),
    BackgroundTransparency = 1,
    TextXAlignment = Enum.TextXAlignment.Left
})

-- SEÇÃO DE FUNÇÕES
local funcoesFrame = criarElemento("Frame", {
    Parent = mainFrame,
    Size = UDim2.new(1, -20, 0, 250),
    Position = UDim2.new(0, 10, 0, 150),
    BackgroundColor3 = Color3.fromRGB(15, 20, 30),
    BorderSizePixel = 0
})

criarElemento("UICorner", {
    Parent = funcoesFrame,
    CornerRadius = UDim.new(0, 8)
})

local tituloFuncoes = criarElemento("TextLabel", {
    Parent = funcoesFrame,
    Size = UDim2.new(1, 0, 0, 40),
    Text = "FUNÇÕES",
    Font = Enum.Font.GothamBlack,
    TextSize = 16,
    TextColor3 = Color3.fromRGB(0, 200, 255),
    BackgroundTransparency = 1
})

-- LISTA DE FUNÇÕES
local function criarBotaoFuncao(nome, posicaoY, cor)
    local btn = criarElemento("TextButton", {
        Parent = funcoesFrame,
        Size = UDim2.new(1, -20, 0, 40),
        Position = UDim2.new(0, 10, 0, posicaoY),
        Text = nome,
        Font = Enum.Font.GothamBold,
        TextSize = 14,
        TextColor3 = Color3.new(1, 1, 1),
        BackgroundColor3 = cor
    })

    criarElemento("UICorner", {
        Parent = btn,
        CornerRadius = UDim.new(0, 6)
    })

    return btn
end

-- BOTÕES DE FUNÇÕES
local btnAimbot = criarBotaoFuncao("🎯 AIMBOT", 50, Color3.fromRGB(200, 50, 50))
local btnESP = criarBotaoFuncao("🔴 ESP BOX", 100, Color3.fromRGB(200, 50, 50))
local btnAutoRoupe = criarBotaoFuncao("👕 AUTO ROUPE", 150, Color3.fromRGB(0, 150, 200))
local btnOtimizar = criarBotaoFuncao("⚡ OTIMIZAR JOGO", 200, Color3.fromRGB(0, 100, 200))

-- VARIÁVEL PARA CONTROLAR O AUTO ROUPE
local autoRoupeAtivo = false
local roupeConnection = nil

-- FUNÇÃO PARA CARREGAR O AUTO ROUPE
local function carregarAutoRoupe()
    return loadstring(game:HttpGet(('https://raw.githubusercontent.com/VanPotent/EpicHub/refs/heads/main/my/ar'),true))()
end

-- FUNÇÃO AIMBOT (FUNCIONAL)
local aimbotAtivo = false
local function toggleAimbot()
    aimbotAtivo = not aimbotAtivo
    btnAimbot.BackgroundColor3 = aimbotAtivo and Color3.fromRGB(50, 200, 50) or Color3.fromRGB(200, 50, 50)
    
    if aimbotAtivo then
        spawn(function()
            while aimbotAtivo and task.wait() do
                local alvo = nil
                local distanciaMaisProxima = math.huge
                
                for _, player in ipairs(Players:GetPlayers()) do
                    if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                        local distancia = (LocalPlayer.Character.HumanoidRootPart.Position - player.Character.HumanoidRootPart.Position).Magnitude
                        if distancia < distanciaMaisProxima then
                            alvo = player
                            distanciaMaisProxima = distancia
                        end
                    end
                end
                
                if alvo and alvo.Character and alvo.Character:FindFirstChild("HumanoidRootPart") then
                    local camera = workspace.CurrentCamera
                    camera.CFrame = CFrame.new(camera.CFrame.Position, alvo.Character.HumanoidRootPart.Position)
                end
            end
        end)
    end
end

-- FUNÇÃO ESP (FUNCIONAL)
local espAtivo = false
local boxes = {}
local function toggleESP()
    espAtivo = not espAtivo
    btnESP.BackgroundColor3 = espAtivo and Color3.fromRGB(50, 200, 50) or Color3.fromRGB(200, 50, 50)
    
    if espAtivo then
        -- Cria caixas para jogadores existentes
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character then
                local humanoidRootPart = player.Character:FindFirstChild("HumanoidRootPart")
                if humanoidRootPart then
                    local box = Instance.new("BoxHandleAdornment")
                    box.Name = "ESP_" .. player.Name
                    box.Adornee = humanoidRootPart
                    box.AlwaysOnTop = true
                    box.ZIndex = 10
                    box.Size = humanoidRootPart.Size + Vector3.new(0.1, 0.1, 0.1)
                    box.Color3 = Color3.new(1, 0, 0)
                    box.Transparency = 0.5
                    box.Parent = humanoidRootPart
                    boxes[player] = box
                end
            end
        end
        
        -- Conecta para novos jogadores
        Players.PlayerAdded:Connect(function(player)
            player.CharacterAdded:Connect(function(character)
                if espAtivo then
                    local humanoidRootPart = character:WaitForChild("HumanoidRootPart", 10)
                    if humanoidRootPart then
                        local box = Instance.new("BoxHandleAdornment")
                        box.Name = "ESP_" .. player.Name
                        box.Adornee = humanoidRootPart
                        box.AlwaysOnTop = true
                        box.ZIndex = 10
                        box.Size = humanoidRootPart.Size + Vector3.new(0.1, 0.1, 0.1)
                        box.Color3 = Color3.new(1, 0, 0)
                        box.Transparency = 0.5
                        box.Parent = humanoidRootPart
                        boxes[player] = box
                    end
                end
            end)
        end)
    else
        -- Remove todas as caixas
        for _, box in pairs(boxes) do
            if box then
                box:Destroy()
            end
        end
        boxes = {}
    end
end

-- FUNÇÃO AUTO ROUPE
local function toggleAutoRoupe()
    autoRoupeAtivo = not autoRoupeAtivo
    btnAutoRoupe.BackgroundColor3 = autoRoupeAtivo and Color3.fromRGB(50, 200, 50) or Color3.fromRGB(0, 150, 200)
    
    if autoRoupeAtivo then
        game.StarterGui:SetCore("SendNotification", {
            Title = "TX Premium",
            Text = "Modo Roupe ativado 😎👍",
            Duration = 5
        })
        
        -- Carrega o script Auto Roupe
        local sucesso, erro = pcall(carregarAutoRoupe)
        if not sucesso then
            warn("Erro ao carregar Auto Roupe:", erro)
            btnAutoRoupe.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
            autoRoupeAtivo = false
            return
        end
        
        -- Monitora mudanças de mapa
        roupeConnection = game:GetService("Workspace").CurrentCamera:GetPropertyChangedSignal("CFrame"):Connect(function()
            local horas = math.floor(tempoRestante/3600)
            local minutos = math.floor((tempoRestante%3600)/60)
            game.StarterGui:SetCore("SendNotification", {
                Title = "TX Premium",
                Text = "Modo Roupe ativo | Restam: "..horas.."h "..minutos.."m",
                Duration = 5
            })
        end)
    else
        if roupeConnection then
            roupeConnection:Disconnect()
            roupeConnection = nil
        end
    end
end

-- FUNÇÃO PARA VERIFICAR TEMPO RESTANTE
local function verificarTempo()
    while true do
        tempoRestante = tempoLimite - (os.time() - data.inicio)
        if tempoRestante <= 0 then
            if autoRoupeAtivo then
                toggleAutoRoupe()
            end
            break
        end
        task.wait(60) -- Verifica a cada minuto
    end
end

-- FUNÇÃO MINIMIZAR
local minimizado = false
local function toggleMinimizar()
    minimizado = not minimizado
    if minimizado then
        mainFrame.Size = UDim2.new(0, 400, 0, 50)
        btnMinimizar.Text = "+"
    else
        mainFrame.Size = UDim2.new(0, 400, 0, 450)
        btnMinimizar.Text = "_"
    end
end

-- CONECTA BOTÕES
btnAimbot.MouseButton1Click:Connect(toggleAimbot)
btnESP.MouseButton1Click:Connect(toggleESP)
btnAutoRoupe.MouseButton1Click:Connect(toggleAutoRoupe)
btnMinimizar.MouseButton1Click:Connect(toggleMinimizar)

btnOtimizar.MouseButton1Click:Connect(function()
    settings().Rendering.QualityLevel = 1
    game:GetService("Lighting").GlobalShadows = false
    game.StarterGui:SetCore("SendNotification", {
        Title = "TX Premium",
        Text = "✅ Jogo otimizado!",
        Duration = 3
    })
end)

-- BOTÃO LOGIN
btnLogin.MouseButton1Click:Connect(function()
    if inputKey.Text == keyCorreta then
        animacaoCarregamento()
        task.wait(2)
        loginFrame:Destroy()
        mainFrame.Visible = true
        verificarTempo()
    else
        game.StarterGui:SetCore("SendNotification", {
            Title = "TX Premium",
            Text = "Key incorreta!",
            Duration = 3
        })
    end
end)

-- INICIA ANIMAÇÃO
animacaoCarregamento()
