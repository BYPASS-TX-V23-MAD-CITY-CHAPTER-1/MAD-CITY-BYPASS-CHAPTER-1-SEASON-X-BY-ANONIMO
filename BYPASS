-- ANÔNIMO TX - PERFORMANCE SAFE OPTIMIZER
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")
local Workspace = game:GetService("Workspace")
local Stats = game:GetService("Stats")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer

-- Configurações
local RENDER_DISTANCE = 100
local CLEANUP_INTERVAL = 10
local active = true

-- Variáveis globais
local optimizationEnabled = false
local optimizationThread = nil

-- Função para congelar objetos distantes
local function freezeDistantObjects()
    local cam = Workspace.CurrentCamera
    if not cam then return end
    
    local camPos = cam.CFrame.Position
    
    for _, obj in ipairs(Workspace:GetDescendants()) do
        pcall(function()
            if obj:IsA("BasePart") then
                local dist = (camPos - obj.Position).Magnitude
                
                if dist > RENDER_DISTANCE then
                    -- Congelar objetos físicos
                    if not obj.Anchored then
                        obj.Anchored = true
                        obj:SetAttribute("WasAnchored", false)
                    end
                    
                    -- Esconder efeitos
                    if obj:IsA("ParticleEmitter") then
                        obj.Enabled = false
                    end
                    
                    -- Reduzir transparência
                    obj.Transparency = math.min(obj.Transparency + 0.5, 0.9)
                else
                    -- Restaurar objetos próximos
                    if obj:GetAttribute("WasAnchored") == false then
                        obj.Anchored = false
                    end
                    
                    if obj:IsA("ParticleEmitter") then
                        obj.Enabled = true
                    end
                    
                    obj.Transparency = 0
                end
            end
            
            -- Processar explosões e fogos
            if (obj:IsA("Explosion") or (obj:IsA("Fire")) and dist > RENDER_DISTANCE then
                obj.Enabled = false
            end
        end)
    end
end

-- Função para remover texturas
local function removeTextures()
    for _, obj in ipairs(Workspace:GetDescendants()) do
        pcall(function()
            -- Remover texturas de objetos
            if obj:IsA("Texture") or obj:IsA("Decal") then
                obj.Transparency = 1
            end
            
            -- Remover texturas de personagens
            if obj:IsA("CharacterMesh") or obj:IsA("ShirtGraphic") then
                obj:Destroy()
            end
            
            -- Simplificar materiais
            if obj:IsA("BasePart") then
                obj.Material = Enum.Material.Plastic
                obj.Reflectance = 0
            end
        end)
    end
    
    -- Processar players
    for _, player in ipairs(Players:GetPlayers()) do
        pcall(function()
            if player.Character then
                -- Remover texturas de roupas
                for _, accessory in ipairs(player.Character:GetDescendants()) do
                    if accessory:IsA("Shirt") or accessory:IsA("Pants") or accessory:IsA("ShirtGraphic") then
                        accessory:Destroy()
                    end
                    
                    -- Congelar animações distantes
                    local humanoid = player.Character:FindFirstChild("Humanoid")
                    if humanoid and player ~= LocalPlayer then
                        local root = player.Character:FindFirstChild("HumanoidRootPart")
                        if root and (root.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude > RENDER_DISTANCE then
                            humanoid.WalkSpeed = 0
                        else
                            humanoid.WalkSpeed = 16
                        end
                    end
                end
            end
        end)
    end
end

-- Função principal de otimização
local function optimizePerformance()
    pcall(function()
        -- Configurações de ambiente
        Lighting.GlobalShadows = false
        Lighting.FogEnd = RENDER_DISTANCE * 1.5
        settings().Rendering.QualityLevel = 1
        
        -- Remover texturas
        removeTextures()
        
        -- Congelar objetos distantes
        freezeDistantObjects()
        
        -- Desativar sons distantes
        for _, sound in ipairs(Workspace:GetDescendants()) do
            pcall(function()
                if sound:IsA("Sound") then
                    local dist = (Workspace.CurrentCamera.CFrame.Position - sound.Position).Magnitude
                    if dist > RENDER_DISTANCE then
                        sound.Volume = 0
                    end
                end
            end)
        end
    end)
end

-- Sistema de otimização automática
local function startOptimization()
    if optimizationThread then return end
    
    optimizationThread = task.spawn(function()
        while optimizationEnabled and active do
            optimizePerformance()
            task.wait(CLEANUP_INTERVAL)
        end
        optimizationThread = nil
    end)
end

-- Configuração da GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "SafePerformanceOptimizer"
screenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
screenGui.ResetOnSpawn = false

-- Botão de Alternar
local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0, 200, 0, 35)
toggleButton.Position = UDim2.new(0, 20, 0, 20)
toggleButton.Text = "Mostrar Otimizador"
toggleButton.BackgroundColor3 = Color3.fromRGB(50, 50, 70)
toggleButton.TextColor3 = Color3.new(1, 1, 1)
toggleButton.Font = Enum.Font.GothamBold
toggleButton.TextSize = 14
toggleButton.Parent = screenGui

local toggleCorner = Instance.new("UICorner")
toggleCorner.CornerRadius = UDim.new(0, 8)
toggleCorner.Parent = toggleButton

-- Display de FPS e Memória
local fpsLabel = Instance.new("TextLabel")
fpsLabel.Size = UDim2.new(0, 200, 0, 30)
fpsLabel.Position = UDim2.new(0, 230, 0, 20)
fpsLabel.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
fpsLabel.BackgroundTransparency = 0.3
fpsLabel.TextColor3 = Color3.new(1, 1, 1)
fpsLabel.Font = Enum.Font.GothamBold
fpsLabel.TextSize = 14
fpsLabel.Text = "FPS: 0 | Mem: 0MB"
fpsLabel.Parent = screenGui

local fpsCorner = Instance.new("UICorner")
fpsCorner.CornerRadius = UDim.new(0, 6)
fpsCorner.Parent = fpsLabel

-- Frame Principal
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 280, 0, 150)
frame.Position = UDim2.new(0, 20, 0, 100)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
frame.BackgroundTransparency = 0.05
frame.Visible = false
frame.Active = true
frame.Draggable = true
frame.Parent = screenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 10)
UICorner.Parent = frame

-- Alternar GUI
local uiVisible = false
toggleButton.MouseButton1Click:Connect(function()
    uiVisible = not uiVisible
    frame.Visible = uiVisible
    toggleButton.Text = uiVisible and "Esconder Otimizador" or "Mostrar Otimizador"
end)

-- Título
local title = Instance.new("TextLabel")
title.Text = "PERFORMANCE SAFE OPTIMIZER"
title.Size = UDim2.new(1, 0, 0, 30)
title.BackgroundTransparency = 1
title.TextColor3 = Color3.fromRGB(200, 200, 255)
title.Font = Enum.Font.GothamBold
title.TextSize = 18
title.Parent = frame

-- Botão de Ativação
local toggleOptBtn = Instance.new("TextButton")
toggleOptBtn.Size = UDim2.new(1, -30, 0, 35)
toggleOptBtn.Position = UDim2.new(0, 15, 0, 40)
toggleOptBtn.Text = "ATIVAR OTIMIZAÇÃO"
toggleOptBtn.BackgroundColor3 = Color3.fromRGB(70, 150, 70)
toggleOptBtn.TextColor3 = Color3.new(1, 1, 1)
toggleOptBtn.Font = Enum.Font.GothamBold
toggleOptBtn.TextSize = 16
toggleOptBtn.Parent = frame

local toggleCorner = Instance.new("UICorner")
toggleCorner.CornerRadius = UDim.new(0, 6)
toggleCorner.Parent = toggleOptBtn

toggleOptBtn.MouseButton1Click:Connect(function()
    optimizationEnabled = not optimizationEnabled
    
    if optimizationEnabled then
        startOptimization()
        toggleOptBtn.Text = "DESATIVAR OTIMIZAÇÃO"
        toggleOptBtn.BackgroundColor3 = Color3.fromRGB(150, 70, 70)
    else
        toggleOptBtn.Text = "ATIVAR OTIMIZAÇÃO"
        toggleOptBtn.BackgroundColor3 = Color3.fromRGB(70, 150, 70)
    end
end)

-- Botão de Render Distance
local renderBtn = Instance.new("TextButton")
renderBtn.Size = UDim2.new(1, -30, 0, 35)
renderBtn.Position = UDim2.new(0, 15, 0, 85)
renderBtn.Text = "DISTÂNCIA: " .. RENDER_DISTANCE .. " ESTUDOS"
renderBtn.BackgroundColor3 = Color3.fromRGB(70, 70, 150)
renderBtn.TextColor3 = Color3.new(1, 1, 1)
renderBtn.Font = Enum.Font.GothamBold
renderBtn.TextSize = 14
renderBtn.Parent = frame

local renderCorner = Instance.new("UICorner")
renderCorner.CornerRadius = UDim.new(0, 6)
renderCorner.Parent = renderBtn

renderBtn.MouseButton1Click:Connect(function()
    RENDER_DISTANCE = RENDER_DISTANCE == 100 and 50 or RENDER_DISTANCE == 50 and 150 or 100
    renderBtn.Text = "DISTÂNCIA: " .. RENDER_DISTANCE .. " ESTUDOS"
end)

-- Monitor de FPS
local fps, frames = 0, 0
RunService.RenderStepped:Connect(function(dt)
    frames += 1
    fps += dt
    if fps >= 1 then
        local mb = math.floor(Stats:GetTotalMemoryUsageMb())
        fpsLabel.Text = "FPS: " .. tostring(math.floor(frames / fps)) .. " | Mem: " .. mb .. "MB"
        fps, frames = 0, 0
    end
end)

-- Função para restaurar estado original
local function restoreOriginalState()
    for _, obj in ipairs(Workspace:GetDescendants()) do
        pcall(function()
            if obj:GetAttribute("WasAnchored") == false then
                obj.Anchored = false
            end
            
            if obj:IsA("ParticleEmitter") then
                obj.Enabled = true
            end
            
            obj.Transparency = 0
        end)
    end
    
    for _, player in ipairs(Players:GetPlayers()) do
        pcall(function()
            if player.Character then
                local humanoid = player.Character:FindFirstChild("Humanoid")
                if humanoid then
                    humanoid.WalkSpeed = 16
                end
            end
        end)
    end
end

-- Desativar ao resetar
LocalPlayer.CharacterRemoving:Connect(function()
    active = false
    restoreOriginalState()
    if optimizationThread then
        task.cancel(optimizationThread)
    end
end)

-- Notificação inicial
local function notify(message)
    local notif = Instance.new("TextLabel")
    notif.Text = message
    notif.Size = UDim2.new(0, 300, 0, 40)
    notif.Position = UDim2.new(0.5, -150, 0.1, 0)
    notif.BackgroundColor3 = Color3.fromRGB(30, 100, 180)
    notif.BackgroundTransparency = 0.2
    notif.TextColor3 = Color3.new(1, 1, 1)
    notif.Font = Enum.Font.GothamBold
    notif.TextSize = 18
    notif.AnchorPoint = Vector2.new(0.5, 0)
    notif.Parent = screenGui

    local notifCorner = Instance.new("UICorner")
    notifCorner.CornerRadius = UDim.new(0, 6)
    notifCorner.Parent = notif

    task.delay(3, function()
        if notif and notif.Parent then
            notif:Destroy()
        end
    end)
end

notify("Performance Safe Optimizer carregado!")
